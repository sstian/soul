---
title: DevOps 实践
categories: Reading
tags:
  - Book
  - DevOps
abbrlink: 221f
date: 2023-08-13 20:58:37
---

## 凤凰项目：一个IT运维的传奇故事

**The Phoenix Project
A Novel About IT, DevOps, and Helping Your Business Win**

[美] 基恩·金 (Gene Kim) 凯文·贝尔 (Kevin Behr) 乔治·斯帕福德 (George Spafford) /著

COO = Chief Operation Officer 首席营运官
CIO = Chief Information Officer 首席信息官 / = “Career Is Over” 职业生涯结束了
ITIL = Information Technology Infrastructure Library 信息技术基础架构库
ITSM = Information Technology Service Management 信息技术服务管理
WIP = Work in Process 在制品

### 经典语录

有些书适合给你的朋友，为了分享阅读的喜悦；有些书适合给你的同事，为了建立理念的共识；有些书适合给你的老板，为了播下伟大的种子。

电影《拯救大兵瑞恩》：这里有一系列的命令：只可对上抱怨，不许对下牢骚。

### 虚构人物语录

比尔·帕尔默：
- 要想在IT运维管理的岗位上做得长久，一定得有足够的资历，这样才能把事情干好。但是一定要低调，不能卷入政治斗争，以免惹祸上身。副总裁们整天做的就是互发PPT。
- 俗话说得好，如果你的同事主动告诉你他们要离职，那多半是自愿的。但如果是其他人告诉你的，那他们一定是被迫的。
- 海军陆战队，保持军营干净整洁不只是为了美观，更是为了安全。
- 靠道听途说可没法破案，当然也没法解决服务中断故障。
- 知道真相总好过一无所知。
- 再也没有比阻止人们去做他们理应做的事更能毁掉大家的热情和支持了。我不认为我们还能有第二次机会让事情走上正轨。
- 80/20法则在这里似乎同样适用：80%的风险是由20%的变更造成的。
- 流程是用来保护人的。
- 埃瑞克把半成品称为“沉默的杀手”，车间控制半成品的能力不足，是造成长期性延误和质量问题的根源之一。
- 搞死你的不是前期投入，而是后台的运行和维护。
- 告知真相是一种爱的表现。隐瞒真相是一种恨的表现。甚至更糟，是一种冷漠的表现。
- 开发和QA的环境与生产环境不匹配，绝对不应该发生这样的事。

埃瑞克：
- 只有掌握了战术，才能实现战略目标。
- 半成品是个隐形杀手。因此，管理任何一家工厂最关键的机制之一，就是工作任务和原材料的发布。没有这个机制，就无法控制半成品。
- 不应该根据第一个工作站的效率来安排工作，而是根据瓶颈资源所能完成工作的速度来安排工作。
- 创建约束理论的艾利·高德拉特告诉我们，在瓶颈之外的任何地方做出的改进都是假象。（所有在非约束点所做的改进都是假象）
- 作为IT运维部的副总裁，你的工作是确保形成一条迅速、可预测、持续不断的计划内工作流，从而向业务部门交付工作价值，同时尽可能降低计划外工作的影响和破坏，那样你才能提供稳定的、可预期的、安全的IT服务。
- 反复实践是精通工作的先决条件。
- 不仅仅是要减少半成品。相比于向系统中投入更多的工作，将无用的工作剔出系统更为重要。
- 重要的是结果，而非过程、管理，或者你完成了哪些工作。
- 每个工作中心都由四种东西组成：机器、人员、方法，以及测评。
- 研究表明，每天训练5分钟比每周开展一次为期3小时的训练更有效。
- 一个给定资源的等待时间，是那个资源忙碌时间的百分比除以空闲时间的百分比。因此，如果一个资源使用了50%，等待时间就是50/50，或者说1个单位。
- （信息安全）可以不对IT系统做过多无用功就保护公司，这才是你的胜利。如果你能把那些无用功剔出IT系统，你的胜利就更进一步。
- 把整个环境创建流程自动化。
- 要记住，你身边有很多经验丰富的人，他们也踏上过同样的旅程，所以，你可别因为不去找人帮忙，而变成一个失败的傻瓜啊。
- 一时的救世主固然好，但普世的圣经则更有用。

史蒂夫：
- 一个伟大的团队并不代表他们拥有最聪明的人。使团队变得伟大的因素，是每个人都互相信任。当那种神奇的动力出现，就会让整个团队充满力量。（凝聚力）
- 兰西奥尼教导我们，展现自己脆弱的一面有助于建立起信任的基础。
- IT不只是一个部门。相反，它就像电力一样无处不在。IT是一种技能，就像能读会算一样。
- 每一个称职的COO都会是从IT部门出来的。任何尚未精通IT系统就负责管理公司运行的COO，都只会是金玉其外的傀儡，需要依靠别人来开展工作。

玛姬·李：
- 在竞争的时代，游戏规则就是“快速上市，快速淘汰”。我们需要短而快的周期，不断整合来自市场的反馈。

### 现实人物语录

卡伦·马丁和麦克·奥斯特林《Value Stream Mapping》：
价值流：一个组织基于客户的需求所执行的一系列有序的交付活动，或者是为了给客户设计、生产和提供产品或服务所需从事的一系列活动，它包含了信息流和物料流的双重价值。

爱德华·戴明博士：没人会强迫你学习……学习也并非生存必需。（自驱的学习才有用）
克里斯托弗·利特尔：DevOps不仅是自动化，就像天文学不只是望远镜一样。
通用电气公司 首席执行官 伊梅尔特：没有将软件作为核心业务的每一个行业或公司都会受到影响。
微软 技术院士 杰弗里·斯诺弗：在过去的经济时代，企业通过移动原子创造价值。而现在，他们必须通过数字创造价值。
克里斯托弗·利特尔：每个公司都是科技公司，无论他们认为自己处在哪个行业。银行也只是拥有银行执照的IT公司而已。
高德拉特博士《目标之外》：在任何价值流中，总是有一个流动方向、一个约束点，任何不针对此约束点而做的优化都是假象。
休哈特：循环（即PDCA环）——计划（Plan）、实施（Do）、检查（Check）、改进（Act）。
麦克·奥泽恩：比日常工作更重要的，是对日常工作的持续改进。

帕特里克·兰西奥尼《团队发展的五大障碍》：
1.缺乏信任；2.惧怕冲突；3.欠缺投入（投入激情）；4.逃避责任；5.无视结果。

### 项目管理

变更：对应用程序、数据库、操作系统、网络或硬件进行的物理、逻辑或虚拟操作，并且这样的操作可能对相关服务产生影响。

技术债务：沃德·坎宁安首次提出。类似于金融债务。我们当前所做出的决定会导致一些问题，而这些问题随着时间的推移会越来越难解决，未来可采取的措施也越来越少。即使我们审慎地承担技术债务，也依然会产生利息。

分钟级别的部署前置时间的方法：
向版本控制系统中持续不断地提交小批量的代码变更，并对代码做自动化测试和探索测试，然后再将它部署到生产环境中。这样，我们就能对代码变更在生产环境中的成功运行保持高度自信，同时还能快速地发现并修复可能出现的问题。

预防措施有个问题，就是你很少能知道自己究竟避开了哪些灾难。
要想在现代技术上取得成功，必然需要多方向和多专业领域的协作。
想要在团队中达成相互信任，你需要展现出自己脆弱的一面。
更卓越的领导力其实是为团队创造条件，让团队能在日常工作中感受到这种卓越。
产品负责人不应该只关注具有创新性的产品和功能，还需重视维护工作和移除技术债务等优先级。
任何一个领域或学科想要取得进步和成熟，就需要认真反思它的起源，在反思中寻求不同的观点，并把这些不同观点的来龙去脉思考清楚，这对预见未来发展是非常有帮助的。

IT运维、信息安全和开发等不同职能部门之间的良好合作是成功的关键。
一个IT做得失败的公司，整个公司也都是失败的。
IT公司的任务和价值：
- 对变化莫测的市场做出反应；
- 为客户提供稳定、可靠和安全的服务。

界定问题的性质：
1.经常发生的问题——流程制度
2.偶然发生的问题——规则方法
3.首次发生的“经常问题”——重点决策

提高效率三要素：稳定环境，减少切换成本；可视化目标，掌握全局；紧紧盯住约束点，抓住关键。

四类工作：业务项目，内部项目，变更，计划外工作（破坏性最强）。

五个聚焦步骤：
1.确认约束点。找不到真正的瓶颈，做什么都是多余。
2.利用约束点。不能让约束点闲着，让它一直运转，而不是需要他才运转。
3.迁就约束点。以瓶颈的产出速度作为整个项目的产出速度。使布伦特解决完一个关键后马上解决下一个关键问题，只做关键工作，疏通瓶颈，避免半成品过剩。
4.消灭约束点。可以通过增员，引进新技术，跳过瓶颈等方式提高瓶颈产出速度，降低瓶颈对项目进程的约束。
5.发现新的约束点。主要矛盾被解决后，次要矛盾会上升为主要矛盾。在约束点被消灭后，找到新的约束点，聚焦它，将进一步提高产能。工作流将越来越流畅高效。



### DevOps

DevOps = Development & Operations 开发和运维
infrastructure as code 基础设施即代码
CI = Continuous Integration 持续集成
CD = Continuous Deployment / Continuus Delivery 持续部署/持续交付

“每日10次部署”
DevOps的准则：总有更好的方法
DevOps的原则和模式就是通过整合企业文化、企业架构和技术实践，让下降式螺旋变成上升式螺旋。
DevOps是把精益原则应用到技术价值流中的结果。
DevOps基于精益、约束理论、丰田生产系统、柔性工程、学习型组织、安全文化、人员优化因素等知识体系，并参考了高信任管理文化、服务型领导、组织变动管理等方法论。
精益的两个主要原则：
- 坚信前置时间（把原材料转换为成品所需的时间）是提升质量、客户满意度和员工幸福感的最佳度量指标之一
- 小批量任务的交付是缩短前置时间的一个关键因素

在DevOps中，技术价值流：把业务构想转化为向客户交付价值的、由技术驱动的服务所需要的流程。
流程的输入是既定的业务目标、概念、创意和假设，始于研发部门接受工作，并将它添加到待完成工作列表中。
技术价值流的核心是建立高度信任的文化。

三步工作法：
第一工作法，建立工作流并以可视化方式呈现
第二工作法，根除计划外工作的最大源头
第三工作法，不断给系统增加压力，使其习惯并强化。

**三步工作法**的原则：
- **流动**原则：它加速了从开发、运维到交付给客户的流程。
使工作可见；限制在制品数；减小批量大小；减少交接次数；持续识别和改善约束点；消除价值流中的困境和浪费。
- **反馈**原则：它使我们能建立更加安全可靠的工作体系。
在复杂系统中安全地工作；及时发现问题；群策群力，战胜问题获取新知；在源头保障质量；为下游工作中心而优化。
- **持续**学习与实验原则：它打造出一种高度信任的文化和一种科学的工作方式，并将对组织的改进和创新作为日常工作的一部分。
建立学习型组织和安全文化；将日常工作的改进制度化；把局部发现转化为全局优化；在日常工作中注入弹性模式；领导层强化学习文化。

更快、更廉价、更低风险的软件交付趋势正加速发展：

|            | 1970~1989 年              | 1990~1999 年           | 2000 年~至今                              |
| ---------- | ------------------------- | ---------------------- | ----------------------------------------- |
| 时代       | 主机                      | 客户端/服务器          | 商品化和云计算                            |
| 标志性技术 | COBOL、运行在MVS上的DB2等 | C++、Oracle、Solaris等 | Java、MySQL、RedHat、Ruby on Rails、PHP等 |
| 交付周期   | 1~5年                     | 3~12个月               | 2~12个星期                                |
| 成本       | 100万~1亿美元             | 10万~1000万美元        | 1万~100万美元                             |
| 风险级别   | 整个公司                  | 产品线或部门           | 产品特性                                  |
| 失败成本   | 破产、出售公司、大量裁员  | 业务亏损、CIO革职      | 可忽略不计                                |

罗恩·韦斯特拉姆的组织类型学模型：

| 病态型         | 官僚型               | 生机型         |
| -------------- | -------------------- | -------------- |
| 隐瞒信息       | 忽略信息             | 积极探索信息   |
| 消灭信使       | 不重视信使           | 训练信使       |
| 逃避责任       | 各自担责             | 共担责任       |
| 阻碍团队的互动 | 容忍团队的互动       | 鼓励团队间结盟 |
| 隐瞒事故       | 组织是公道和宽容的   | 调查事故根因   |
| 压制新想法     | 认为新想法会造成麻烦 | 接纳新想法     |

### 思想感悟

- 浴火重生的叫凤凰，浴火成灰的叫火鸡。
- 获得别人好感，拉进别人距离的好办法就是很自然的说出这个人的一些事儿。
- 在约束理论中曾经提到过，所有人都在忙碌是一件很可怕的事情，这不是高效的表现。所有在非瓶颈处的更高效率都是无用功，甚至可能有副作用。
- 工作的动力大部分是成就感，而不是一直被某些人或者事情追着跑。需要时间静下心来思考。

> IT技术，应用层日新月异，要保持学习；底层变化不大，要夯实基础。基础不牢，地动山摇。
